<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Path of Exile 2 - WEU Creators Leaderboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Metamorphous&display=swap" rel="stylesheet">
    <style>
        :root { --poe-gold: #8e734a; --poe-red: #ff4500; --corrupt-red: #8b0000; }
        * { font-family: 'Cinzel', serif !important; cursor: url('https://web.poecdn.com/image/layout/cursor-pointer.png'), auto !important; user-select: none; }
        body { background-color: #050505; background-image: linear-gradient(to bottom, rgba(5, 5, 5, 0.6), rgba(5, 5, 5, 0.95)), url('https://i.ibb.co/Q3R6wF9Z/The-Lastofthe-Druids-MAINKEYART-Background.png'); background-attachment: fixed; background-size: cover; background-position: center; color: #a38d6d; overflow-x: hidden; scroll-behavior: smooth; margin: 0; transition: filter 0.5s ease; }
        body::after { content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, transparent 65%, rgba(0,0,0,0.5) 100%); pointer-events: none; z-index: 40; }
        body.corrupted { filter: sepia(0.5) saturate(1.8) hue-rotate(-50deg); }
        body.corrupted .card-glass { border-color: var(--corrupt-red); box-shadow: 0 0 15px rgba(139, 0, 0, 0.2); }
        #preloader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #050505; z-index: 9999; display: flex; flex-direction: column; justify-content: center; items-center; transition: opacity 0.8s ease; }
        .rune-loader { font-family: 'Metamorphous' !important; font-size: 5rem; color: var(--poe-gold); animation: pulse-rune 2s infinite; }
        .loot-drop { position: absolute; pointer-events: none; padding: 4px 12px; border: 2px solid; font-weight: bold; font-size: 13px; z-index: 100; animation: floatUp 2s forwards; background: rgba(0,0,0,0.95); font-family: sans-serif !important; letter-spacing: 1px; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-80px); } }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 50% { transform: translate(-1px, 2px) rotate(1deg); } 100% { transform: translate(1px, -2px) rotate(0deg); } }
        .shake-effect { animation: shake 0.4s; }
        #loot-flash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; opacity: 0; pointer-events: none; z-index: 200; transition: opacity 0.1s; }
        #char-tooltip { position: absolute; display: none; background: rgba(10, 10, 10, 0.95); border: 1px solid var(--poe-gold); padding: 12px; z-index: 500; width: 180px; box-shadow: 0 0 20px rgba(0,0,0,0.8); pointer-events: none; }
        #global-log { position: fixed; bottom: 20px; left: 20px; width: 350px; height: 130px; pointer-events: none; z-index: 50; overflow: hidden; mask-image: linear-gradient(to bottom, black 85%, transparent 100%); }
        .log-entry { font-family: sans-serif !important; font-size: 11px; margin-bottom: 2px; text-shadow: 1px 1px 1px black; animation: logSlide 0.3s ease-out; }
        @keyframes logSlide { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        .chat-death { color: #ff4d4d; } .chat-global { color: #60c1e8; } .chat-trade { color: #abe33d; } .chat-info { color: #afadab; }
        .card-glass { background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(142, 115, 74, 0.2); }
        .points-glow { color: #ffb84d; text-shadow: 0 0 12px rgba(255, 184, 77, 0.5); font-family: 'Metamorphous' !important; }
        .active-stream { background: rgba(142, 115, 74, 0.15) !important; border-left: 3px solid var(--poe-gold); }
        #emberCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; opacity: 0.5; }
    </style>
</head>
<body onload="hideLoader()" onclick="spawnLoot(event)">
    <div id="preloader"><div class="rune-loader">áš¦</div></div>
    <div id="loot-flash"></div>
    <div id="char-tooltip"></div>
    <div id="global-log"></div>
    <canvas id="emberCanvas"></canvas>

    <div class="relative-z fixed top-4 right-4 z-[100] flex flex-col items-end gap-3">
        <div class="bg-black/80 border border-[#8e734a]/40 px-3 py-2 flex gap-4 rounded-sm shadow-xl">
            <div class="flex flex-col items-center"><span class="text-[8px] text-stone-500 uppercase">Mirrors</span><span id="mir-count" class="text-cyan-400 font-bold text-xs">0</span></div>
            <div class="flex flex-col items-center border-l border-white/10 pl-4"><span class="text-[8px] text-stone-500 uppercase">Divines</span><span id="div-count" class="text-yellow-500 font-bold text-xs">0</span></div>
        </div>
        <div class="flex gap-2">
            <button onclick="corruptSite()" class="bg-red-900/40 border border-red-600 text-red-500 px-3 py-1 text-[9px] uppercase font-bold hover:bg-red-600 hover:text-white transition">Vaal Orb</button>
            <button id="music-toggle" onclick="toggleMusic()" class="bg-black/80 border border-white/10 text-[#8e734a] px-3 py-1 text-[9px] uppercase font-bold">
                <span id="music-status">ðŸ”ˆ Music Off</span>
            </button>
        </div>
        <audio id="bgMusic" loop><source src="theme.mp3" type="audio/mpeg"></audio>
    </div>

    <header class="relative-z pt-12 pb-8 flex flex-col items-center text-center">
        <img src="https://i.ibb.co/zTKghTd2/Po-E2-The-Lastofthe-Druids-EN.png" class="max-w-xs md:max-w-md h-auto drop-shadow-2xl mb-8">
        <nav class="flex gap-8 uppercase text-[10px] tracking-[0.3em] font-bold bg-black/60 px-8 py-4 rounded-full border border-white/10 backdrop-blur-md">
            <a href="index.html" class="hover:text-white transition">Live</a>
            <a href="builds.html" class="hover:text-white transition">Builds</a>
            <a href="#about" class="hover:text-white transition">About Path of Exile 2</a>
            <a href="#shop" class="text-yellow-600 hover:text-yellow-400 font-bold">BUY NOW</a>
        </nav>
    </header>

    <main class="relative-z max-w-6xl mx-auto px-4 space-y-20 pb-24">
        <section id="livestream" class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <div class="lg:col-span-3 card-glass overflow-hidden flex flex-col">
                <div class="aspect-video bg-black"><iframe id="twitchEmbed" src="" height="100%" width="100%" allowfullscreen="true" frameborder="0"></iframe></div>
                <div class="p-4 flex justify-between items-center bg-black/40 border-t border-white/5">
                    <div class="flex items-center gap-3"><img id="currentStreamerAvatar" src="" class="w-10 h-10 border border-[#8e734a]/30"><h3 id="currentStreamerName" class="text-lg text-[#e4c48a] font-bold uppercase tracking-widest">...</h3></div>
                    <select id="streamerSelect" onchange="manualStreamChange()" class="bg-black border border-white/10 px-4 py-1 text-xs text-stone-300 outline-none"></select>
                </div>
            </div>
            <div class="lg:col-span-1 card-glass p-8 flex flex-col justify-between">
                <div><h4 class="text-[10px] uppercase tracking-widest text-white mb-6 flex items-center gap-2 font-bold"><span class="w-2 h-2 bg-red-600 rounded-full animate-pulse"></span> Recommended</h4><h3 class="text-xl text-[#e4c48a] font-bold mb-4 uppercase">Bear Druid Starter</h3><p class="text-[11px] text-stone-400 leading-relaxed mb-8">Master the art of shapeshifting. Focus on massive area damage.</p></div>
                <a href="https://mobalytics.gg/poe-2/builds/bear-druid-build-league-starter-to-endgame" target="_blank" class="bg-gradient-to-r from-[#8e734a] to-[#5d4a2d] text-[#050505] font-bold text-center py-4 text-[10px] tracking-widest uppercase border border-[#c5a572]">Mobalytics Guide</a>
            </div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-12 items-start">
            <div class="lg:col-span-2 space-y-6">
                <div class="flex justify-between items-center border-b border-white/10 pb-4"><h2 class="text-2xl uppercase tracking-[0.2em] text-[#e4c48a]">Exile Rankings</h2><input type="text" id="searchInput" onkeyup="filterTable()" placeholder="Search..." class="bg-transparent border-b border-white/10 text-xs px-4 py-2 outline-none focus:border-[#8e734a] transition text-stone-300"></div>
                <div class="card-glass overflow-hidden"><div class="max-h-[500px] overflow-y-auto custom-scrollbar"><table class="w-full text-left text-xs"><tbody id="leaderboardBody"></tbody></table></div></div>
            </div>
            <div class="lg:col-span-1 card-glass p-10 text-center bg-gradient-to-br from-[#1a130a] to-black" id="shop"><h2 class="text-2xl mb-6 text-[#e4c48a] uppercase">Join the Hunt</h2><a href="https://www.pathofexile.com/poe2" target="_blank" class="bg-gradient-to-r from-[#8e734a] to-[#5d4a2d] text-[#050505] font-bold px-12 py-5 inline-block text-xs tracking-widest border border-[#c5a572]">Buy Now</a></div>
        </div>
    </main>

    <script>
        const kols = [
            { name: "Alderiate", twitch: "alderiate", points: 17800, class: "Warrior", level: 70 },
            { name: "Trymacs", twitch: "trymacs", points: 15400, class: "Druid", level: 92 },
            { name: "metashi12", twitch: "metashi12", points: 14200, class: "Monk", level: 89 },
            { name: "PietSmiet", twitch: "pietsmiet", points: 12800, class: "Warrior", level: 85 },
            { name: "Bonjwa Gaming", twitch: "bonjwa", points: 11500, class: "Huntress", level: 82 },
            { name: "NoWay4u_Sir", twitch: "noway4u_sir", points: 10900, class: "Mercenary", level: 80 },
            { name: "HandOfBlood", twitch: "handofblood", points: 9500, class: "Witch", level: 78 },
            { name: "Terracid", twitch: "terracid", points: 8700, class: "Druid", level: 75 },
            { name: "HoneyPuu", twitch: "honeypuu", points: 8200, class: "Sorceress", level: 72 },
            { name: "Wankil Studio", twitch: "wankilstudio", points: 7500, class: "Ranger", level: 68 },
            { name: "Ponce", twitch: "ponce", points: 7200, class: "Monk", level: 65 },
            { name: "Dhalucard", twitch: "dhalucard", points: 6900, class: "Mercenary", level: 62 },
            { name: "Eligella", twitch: "eligella", points: 6500, class: "Huntress", level: 60 },
            { name: "Maxim", twitch: "maxim", points: 6200, class: "Witch", level: 58 },
            { name: "Joueur Du Grenier", twitch: "joueur_du_grenier", points: 1100, class: "Druid", level: 12 }
        ];

        let m_count = 0; let d_count = 0;
        const runes = ['áš±', 'áš¦', 'áš§', 'áš©', 'áš¼', 'á›', 'á›’', 'á›–', 'á›—', 'á›š'];
        
        // SYSTÃˆME DE POIDS : Plus le weight est Ã©levÃ©, plus l'item est commun.
        const lootPool = [
            { text: "MIRROR OF KALANDRA", color: "#fff", border: "#5df", weight: 1 },
            { text: "DIVINE ORB", color: "#fff", border: "#ff0", weight: 20 },
            { text: "EXALTED ORB", color: "#fff", border: "#ff0", weight: 60 },
            { text: "CHAOS ORB", color: "#ff0", border: "#ff0", weight: 200 },
            { text: "ALCHEMY ORB", color: "#ff0", border: "#ff0", weight: 400 },
            { text: "TRANSMUTE", color: "#fff", border: "#888", weight: 800 },
            { text: "WISDOM SCROLL", color: "#fff", border: "#888", weight: 1500 }
        ];

        function hideLoader() { setTimeout(() => { document.getElementById('preloader').style.opacity = '0'; setTimeout(() => document.getElementById('preloader').style.display = 'none', 800); }, 1200); }
        function toggleMusic() { const m = document.getElementById('bgMusic'); const b = document.getElementById('music-status'); if (m.paused) { m.play(); m.volume = 0.3; b.innerText = "ðŸ”Š Music On"; } else { m.pause(); b.innerText = "ðŸ”ˆ Music Off"; } }
        function corruptSite() { document.body.classList.toggle('corrupted'); }

        function spawnLoot(e) {
            if (e.target.tagName === 'A' || e.target.tagName === 'BUTTON' || e.target.tagName === 'SELECT') return;

            // Calcul du loot basÃ© sur les poids
            const totalWeight = lootPool.reduce((sum, item) => sum + item.weight, 0);
            let random = Math.random() * totalWeight;
            let loot = lootPool[lootPool.length - 1]; 

            for (let item of lootPool) {
                if (random < item.weight) {
                    loot = item;
                    break;
                }
                random -= item.weight;
            }

            const div = document.createElement('div'); div.className = 'loot-drop'; div.innerText = loot.text;
            div.style.left = (e.pageX - 50) + 'px'; div.style.top = e.pageY + 'px';
            div.style.color = loot.color; div.style.borderColor = loot.border;
            
            if (loot.text === "MIRROR OF KALANDRA") { m_count++; document.getElementById('mir-count').innerText = m_count; triggerRare("#5df"); }
            if (loot.text === "DIVINE ORB") { d_count++; document.getElementById('div-count').innerText = d_count; triggerRare("#ff0"); }
            
            document.body.appendChild(div); setTimeout(() => div.remove(), 2000);
        }

        function triggerRare(c) {
            const f = document.getElementById('loot-flash'); f.style.background = c; f.style.opacity = "0.3"; setTimeout(()=> f.style.opacity = "0", 100);
            document.body.classList.add('shake-effect'); setTimeout(()=> document.body.classList.remove('shake-effect'), 400);
        }

        function showTip(e, cls, lvl) {
            const t = document.getElementById('char-tooltip'); t.style.display = 'block'; t.style.left = (e.pageX + 15) + 'px'; t.style.top = (e.pageY + 15) + 'px';
            t.innerHTML = `<div class="text-[#e4c48a] font-bold text-xs uppercase">${cls}</div><div class="text-stone-500 text-[10px] mb-2">Level ${lvl}</div><div class="h-1 bg-gray-800 w-full"><div class="h-full bg-red-700 w-[85%]"></div></div>`;
        }
        function hideTip() { document.getElementById('char-tooltip').style.display = 'none'; }

        function updateStream(t) {
            const domain = window.location.hostname || "localhost";
            document.getElementById('twitchEmbed').src = `https://player.twitch.tv/?channel=${t}&parent=${domain}`;
            document.getElementById('currentStreamerName').innerText = t;
            document.getElementById('currentStreamerAvatar').src = `https://api.dicebear.com/7.x/identicon/svg?seed=${t}&backgroundColor=000000`;
            renderLeaderboard(kols, t);
        }

        function renderLeaderboard(data, current) {
            data.sort((a, b) => b.points - a.points);
            document.getElementById('leaderboardBody').innerHTML = data.map((kol, i) => {
                const active = kol.twitch === current;
                const r = runes[Math.floor(Math.random()*runes.length)];
                return `<tr onclick="updateStream('${kol.twitch}')" onmousemove="showTip(event, '${kol.class}', ${kol.level})" onmouseleave="hideTip()" data-rune="${r}" class="rank-row border-b border-white/5 ${active?'active-stream':''} cursor-help"><td class="p-4 text-center font-bold ${i<3?'text-yellow-500 text-lg':'text-stone-500'}">${i+1}</td><td class="p-4 flex items-center gap-3 font-bold text-stone-200"><img src="https://api.dicebear.com/7.x/identicon/svg?seed=${kol.name}&backgroundColor=000000" class="w-6 h-6 border border-white/10"><span>${kol.name}</span></td><td class="p-4 text-right points-glow text-base">${kol.points.toLocaleString()}</td></tr>`;
            }).join('');
        }

        function filterTable() { renderLeaderboard(kols.filter(k => k.name.toLowerCase().includes(document.getElementById('searchInput').value.toLowerCase())), ""); }

        const logs = [
            { t: "Trymacs has been slain by Hillock.", c: "chat-death" },
            { t: "metashi12 reached Level 90!", c: "chat-global" },
            { t: "PietSmiet has found a Mirror of Kalandra.", c: "chat-trade" },
            { t: "Joueur Du Grenier has died at Rank 15.", c: "chat-death" },
            { t: "Global 1: Anyone for Merveil?", c: "chat-global" },
            { t: "Global 1: Axel your website is so cool!", c: "chat-global" },
            { t: "HandOfBlood: I think Diablo is kind of bad though", c: "chat-global" },
            { t: "Global 1: LET'S GOOOO DIVINE ORBS !", c: "chat-global" },
            { t: "Global 1: rue is a cat?", c: "chat-global" },
            { t: "Ponce has been slain by a Rhoa.", c: "chat-death" },
            { t: "Global 1: Still sane, Exile? No? Me neither.", c: "chat-global" },
            { t: "Wankil Studio: Trading 1 Chaos for 20 Necropolis Maps.", c: "chat-trade" },
            { t: "Global 1: Toucan has been kicked for spam.", c: "chat-info" },
            { t: "Alderiate: Why is this boss so fast?!", c: "chat-global" }
        ];

        function addLog() {
            const l = document.getElementById('global-log'); const m = logs[Math.floor(Math.random()*logs.length)];
            const d = document.createElement('div'); d.className = `log-entry ${m.c}`; d.innerText = m.t;
            l.prepend(d); if (l.childNodes.length > 6) l.removeChild(l.lastChild);
            setTimeout(addLog, Math.random() * 5000 + 4000);
        }

        const canvas = document.getElementById('emberCanvas'); const ctx = canvas.getContext('2d');
        let particles = []; function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize); resize();
        class P { constructor() { this.reset(); this.y = Math.random()*canvas.height; } reset() { this.x = Math.random()*canvas.width; this.y = canvas.height+10; this.size = Math.random()*2; this.speedY = Math.random()*0.5+0.2; this.opacity = Math.random()*0.5; } update() { this.y -= this.speedY; this.opacity -= 0.001; if (this.y < -10 || this.opacity <= 0) this.reset(); } draw() { ctx.fillStyle = `rgba(255, 150, 0, ${this.opacity})`; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI*2); ctx.fill(); } }
        function animate() { ctx.clearRect(0,0,canvas.width,canvas.height); particles.forEach(p=>{p.update();p.draw();}); requestAnimationFrame(animate); }
        for(let i=0; i<40; i++) particles.push(new P());
        animate(); updateStream(kols[0].twitch); addLog();
        document.getElementById('streamerSelect').innerHTML = kols.map(k=>`<option value="${k.twitch}">${k.name}</option>`).join('');
    </script>
</body>
</html>
